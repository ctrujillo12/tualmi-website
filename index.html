<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tualmi - Women's Outdoor Clothing</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant:wght@300;400;500&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <nav class="nav">
        <a href="index.html">
            <img src="/images/logo.png" alt="Tualmi" class="logo">
        </a>

        <div class="nav-links">
            <a href="#collection">COLLECTION</a>
            <a href="#about">ABOUT</a>
            <a href="/cart.html">CART</a>
        </div>
    </nav>

    <section class="hero">
        <img src="/images/tuolumne.jpg" alt="Mountain landscape" class="hero-image">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1 class="brand-name">tualmi</h1>
            <p class="mission">Thoughtfully designed outdoor wear for women who seek adventure without compromise. Sustainably crafted, elegantly refined.</p>
            <div class="eco-badge">
                <span>●</span>
                <span>SUSTAINABLE</span>
            </div>
        </div>
    </section>

    <section class="collection" id="collection">
        <div class="collection-header">
            <h2 class="section-title">Debut Collection</h2>
            <p class="section-subtitle">Elevated essentials for your next journey</p>
        </div>
        
        <div class="product-grid">
            <a href="/products/trailblazer-fleece.html" class="product-card" data-product="trailblazer-fleece" data-price="$110">
                <div class="product-image-container">
                    <img src="/images/pink-fleece.png" alt="Trailblazer Fleece" class="product-image">
                    <div class="product-badge">PRE-ORDER</div>
                </div>
                <div class="product-info">
                    <h3 class="product-name">Trailblazer Fleece</h3>
                    <p class="product-price">$110</p>
                    <div class="color-carousel">
                        <div class="color-swatch active" style="background: linear-gradient(135deg, #d4a5a5 0%, #c49494 100%);" data-image="/images/pink-fleece.png"></div>
                        <div class="color-swatch" style="background: radial-gradient(circle, #2a2a2a 20%, #f0e6db 20%, #f0e6db 40%, #2a2a2a 40%);" data-image="/images/polka-fleece.png"></div>
                        <div class="color-swatch" style="background: #e8d4a0;" data-image="/images/yellow-fleece.png"></div>
                    </div>
                </div>
            </a>

            <a href="/products/trail-capri.html" class="product-card" data-product="trail-capri" data-price="$80">
                <div class="product-image-container">
                    <img src="/images/white-pants.png" alt="Trail Capri" class="product-image">
                    <div class="product-badge">PRE-ORDER</div>
                </div>
                <div class="product-info">
                    <h3 class="product-name">Trail Capri</h3>
                    <p class="product-price">$80</p>
                    <div class="color-carousel">
                        <div class="color-swatch active" style="background: #f5f5f5;" data-image="/images/white-pants.png"></div>
                        <div class="color-swatch" style="background: #6b5648;" data-image="images/brown-pants-bg.png"></div>
                    </div>
                </div>
            </a>

            <a href="/products/summit-pant.html" class="product-card" data-product="summit-pant" data-price="$90">
                <div class="product-image-container">
                    <img src="/images/olive-pants-bg.png" alt="Summit Pant" class="product-image">
                    <div class="product-badge">PRE-ORDER</div>
                </div>
                <div class="product-info">
                    <h3 class="product-name">Summit Pant</h3>
                    <p class="product-price">$90</p>
                    <div class="color-carousel">
                        <div class="color-swatch active" style="background: #5a6650;" data-image="/images/olive-pants-bg.png"></div>
                        <div class="color-swatch" style="background: #7a7a7a;" data-image="images/gray-pants-bg.png"></div>
                    </div>
                </div>
            </a>

            <a href="/products/horizon-shorts.html" class="product-card" data-product="horizon-shorts" data-price="$60">
                <div class="product-image-container">
                    <img src="/images/yellow-shorts-bg.png" alt="Horizon Shorts" class="product-image">
                    <div class="product-badge">PRE-ORDER</div>
                </div>
                <div class="product-info">
                    <h3 class="product-name">Horizon Shorts</h3>
                    <p class="product-price">$60</p>
                </div>
            </a>

            <a href="/products/carabiner.html" class="product-card" data-product="carabiner" data-price="$12">
                <div class="product-image-container">
                    <img src="/images/carabiner.png" alt="Carabiner" class="product-image">
                    <div class="product-badge">PRE-ORDER</div>
                </div>
                <div class="product-info">
                    <h3 class="product-name">Carabiner</h3>
                    <p class="product-price">$12</p>
                </div>
            </a>
        </div>
    </section>


    <footer class="footer" id="about">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3 class="footer-title">Natural Materials</h3>
                    <p class="footer-text">We craft every piece with sustainable, natural fabrics that honor the earth and feel incredible against your skin.</p>
                </div>
                <div class="footer-section">
                    <h3 class="footer-title">Giving Back</h3>
                    <p class="footer-text">5% of all profits support conservation efforts protecting the wild places that inspire us. Together, we've planted over 10,000 trees.</p>
                </div>
                <div class="footer-section">
                    <h3 class="footer-title">Yosemite Inspired</h3>
                    <p class="footer-text">Born from the beauty of Tuolumne Meadows, where granite peaks meet alpine wildflowers and endless possibility.</p>
                </div>
                <div class="footer-section">
                    <h3 class="footer-title">By Women, For Women</h3>
                    <p class="footer-text">Women now make up 47% of outdoor enthusiasts. A California-born brand redefining women's gear with fashion and function at its core.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p class="footer-tagline">Adventure meets elegance</p>
                <p class="footer-copyright">© 2025 Tualmi. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div class="modal" id="preorderModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <div id="formContent">
                <h3 class="modal-product-name" id="modalProductName"></h3>
                <p class="modal-product-price" id="modalProductPrice"></p>
                <form class="preorder-form" name="preorder" method="POST" data-netlify="true" netlify-honeypot="bot-field" onsubmit="submitPreorder(event)">
                    <input type="hidden" name="form-name" value="preorder">
                    <input type="hidden" name="bot-field">
                    <input type="hidden" name="product" id="hiddenProductName">
                    <input type="hidden" name="price" id="hiddenProductPrice">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" name="email" class="form-input" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Size</label>
                        <select name="size" class="form-input" required>
                            <option value="">Select Size</option>
                            <option value="xs">XS</option>
                            <option value="s">S</option>
                            <option value="m">M</option>
                            <option value="l">L</option>
                            <option value="xl">XL</option>
                        </select>
                    </div>
                    <button type="submit" class="submit-btn">Reserve Now</button>
                </form>
            </div>
            <div class="success-message" id="successMessage">
                <div class="success-icon">✓</div>
                <h3 class="success-title">You're All Set</h3>
                <p class="success-text">Thank you for pre-ordering. We'll notify you as soon as your piece is ready to ship.</p>
            </div>
        </div>
    </div>

    <script>
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.15 });

        document.querySelectorAll('.product-card').forEach(card => {
            observer.observe(card);
        });

        document.querySelectorAll('.footer-section').forEach(section => {
            observer.observe(section);
        });

        const modal = document.getElementById('preorderModal');
        const productCards = document.querySelectorAll('.product-card');

        productCards.forEach(card => {
            card.addEventListener('click', function(e) {
                // If the card is a link to a product page, just navigate
                const link = card.getAttribute('href');
                if (link && link.includes('/products/')) {
                    return; // skip modal
                }

                // Ignore color swatch clicks
                if (e.target.closest('.color-swatch')) return;

                const productName = this.querySelector('.product-name').textContent;
                const productPrice = this.querySelector('.product-price').textContent;
                
                document.getElementById('modalProductName').textContent = productName;
                document.getElementById('modalProductPrice').textContent = productPrice;
                document.getElementById('hiddenProductName').value = productName;
                document.getElementById('hiddenProductPrice').value = productPrice;
                
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
        });


        function closeModal() {
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            setTimeout(() => {
                document.getElementById('formContent').style.display = 'block';
                document.getElementById('successMessage').classList.remove('active');
            }, 400);
        }

        async function submitPreorder(e) {
            e.preventDefault();
            const form = e.target;

            // Grab form data
            const formData = new FormData(form);
            const product = formData.get('product');
            const price = parseFloat(formData.get('price').replace('$',''));
            const size = formData.get('size');
            const email = formData.get('email');

            // Build payload matching your backend
            const payload = {
                items: [
                    {
                        name: product,
                        price: price,
                        quantity: 1,
                        size: size,
                        color: '', // you can fill in if you want color selection
                        image: ''  // optional: link to image if you have one
                    }
                ]
            };

            try {
                // Call your Render backend
                const response = await fetch('https://tualmi-website.onrender.com/api/create-checkout-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const session = await response.json();

                // Redirect to Stripe Checkout
                const stripe = Stripe('pk_test_...'); // replace with your Stripe public key
                const { error } = await stripe.redirectToCheckout({ sessionId: session.id });

                if (error) {
                    console.error(error);
                    alert('There was an error redirecting to Stripe. Please try again.');
                }
            } catch (err) {
                console.error(err);
                alert('There was an error submitting your pre-order. Please try again.');
            }
        }

        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });

        document.querySelectorAll('.color-swatch').forEach(swatch => {
            swatch.addEventListener('click', function(e) {
                e.stopPropagation();
                const parent = this.parentElement;
                parent.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                this.classList.add('active');
                
                const card = this.closest('.product-card');
                const productImage = card.querySelector('.product-image');
                
                // If the swatch has a data-image attribute, change the image
                const newImage = this.getAttribute('data-image');
                if (newImage && productImage.tagName === 'IMG') {
                    productImage.src = newImage;
                }
            });
        });

        // Prevent color swatch clicks from following the product link
        document.querySelectorAll('.color-swatch').forEach(swatch => {
            swatch.addEventListener('click', function(e) {
                e.preventDefault(); // stop the link from opening
                e.stopPropagation(); // stop the click from bubbling to the card

                const productCard = this.closest('.product-card');
                const image = productCard.querySelector('.product-image');

                // Update active swatch
                productCard.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                this.classList.add('active');

                // Update product image
                const newImage = this.dataset.image;
                image.src = newImage;
            });
        });

    </script>
</body>
</html>